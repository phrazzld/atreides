# Grooming Plan — 2026-02-28

## Themes Explored

- **A. Foundation Fixes**: Critical risk.py bug, bare exception handlers, settings validation, context manager
- **B. Data Pipeline**: DuckDB schema, market snapshot poller, collect CLI command
- **C. Volatility & Scoring**: Logit-space volatility estimation, composite market scoring, rank CLI
- **D. Trading Readiness**: place_order/cancel_order behind read-only guard, dry-run mode
- **E. Test Hardening**: CLI tests, error scenarios, position reconstruction edge cases

## Directions Locked

All five themes — Foundation fixes first, then data pipeline, then analytics and trading readiness in parallel, tests throughout.

## Issues Created

- #1: [P0] Fix RiskManager crash (score: ~85)
- #2: [P1] Harden exchange adapter (score: ~80)
- #3: [P1] Add Settings validation (score: ~80)
- #4: [P1] DuckDB data store (score: ~85)
- #5: [P1] Market snapshot poller + collect CLI (score: ~85)
- #6: [P1] Logit-space volatility estimator (score: ~80)
- #7: [P1] Market scoring + rank CLI (score: ~80)
- #8: [P1] Implement place_order/cancel_order (score: ~80)
- #9: [P1] Add dry-run trading mode (score: ~80)
- #10: [P2] CLI + error scenario tests (score: ~75)
- #11: [P2] Exchange adapter + position tests (score: ~75)

## Execution Order

```
#1 (P0 bug) → #2 (harden adapter) → #3 (settings validation)
                    ↓
#4 (DuckDB store) → #5 (poller + collect)
                    ↓
#6 (volatility) → #7 (scoring + rank)
                    ↓
#8 (place_order) → #9 (dry-run)

#10, #11 (tests) — in parallel throughout
```

## Deferred

- **Orderbook depth snapshots**: Not needed for Phase 2 scoring. Revisit for Phase 4 A-S quoting.
- **WebSocket streaming**: REST polling is sufficient at 30s intervals. Add when actively quoting.
- **Jump-diffusion volatility (EM)**: Tier 3 sophistication. Start with rolling stddev + EWMA.
- **Polymarket adapter**: Exchange abstraction ready. Add when waitlist clears.
- **Graceful shutdown / cancel-all-on-exit**: Phase 3 when actually running unattended.
- **Daily Parquet export**: Nice-to-have after data pipeline is running.

## Research Findings

### Key insight: Logit-space volatility
Binary market prices bounded [0,1] break standard volatility estimation. The Oct 2025 arxiv paper "Toward Black-Scholes for Prediction Markets" provides the framework: transform to logit space, estimate sigma_b as diffusion coefficient of log-odds, use sigmoid to naturally compress spreads near boundaries.

### Kalshi rate limits
Basic tier: 20 reads/sec. Batch endpoints (`get_markets(limit=200)`) make polling efficient. 200 markets at 30s interval = 0.03 req/sec. WebSocket available for high-frequency data on actively quoted markets.

### Reference bot gap
No public bot implements logit-space volatility or A-S adapted for binary markets. All use volume ranking or LLM-based decisions. This is a genuine edge.

### Risk module was broken
`RiskManager.check_order()` references `Position.net_exposure` and `Position.avg_price` — neither exists. Tests passed only because they used empty position lists. Must fix before any trading work.
